# μ„λ²„ ν†µμ‹  μ—λ¬ μ²λ¦¬ κµ¬ν„ κ³„ν λ° μ§„ν–‰ μƒν™©

## π“ ν”„λ΅μ νΈ κ°μ”

### λ¬Έμ  μƒν™©
ν„μ¬ μ„λ²„ ν†µμ‹ κ°„ μ—λ¬κ°€ λ°μƒν•λ” κ²½μ°μ— λ€ν• μΆ‹μ€ μμ™Έμ²λ¦¬κ°€ ν•„μ”ν•©λ‹λ‹¤.

### ν„μ¬ κµ¬μ΅°
1. **ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈ**: μ„λ²„ μ•΅μ…μ„ ν†µν•΄μ„ νΈμ¶λλ©° ApiClientλ¥Ό ν†µν•΄ μ‹¤μ  μ”μ²­μ΄ λ°μƒ
2. **μ„λ²„ μ»΄ν¬λ„νΈ**: μ„λ²„ μ•΅μ…μ„ ν†µν•΄μ„ νΈμ¶λλ©° ApiClientλ¥Ό ν†µν•΄ μ‹¤μ  μ”μ²­μ΄ λ°μƒ

### κµ¬ν„ λ©ν‘
1. **ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈ**μ—μ„ μ—λ¬ λ°μƒμ‹ toastλ¥Ό ν†µν•΄μ„ μ μ ν• μ—λ¬ μ‘λ‹µ
2. **μ„λ²„ μ»΄ν¬λ„νΈ**μ—μ„ μ—λ¬ λ°μƒμ‹ μ •μλ notFound, forbidden λ“± μ—λ¬νμ΄μ§€λ΅ μ΄λ™

### ν•µμ‹¬ μ”κµ¬μ‚¬ν•­
- **Next.js 15** ν•¨μ μ‚¬μ©: `notFound()`, `forbidden()`, `unauthorized()`
- **μ¤‘μ•™ μ§‘μ¤‘μ‹ μ²λ¦¬**: νΈμ¶μκ°€ ν΄λΌμ΄μ–ΈνΈ/μ„λ²„ μ»΄ν¬λ„νΈ κµ¬λ¶„ μ—†μ΄ μ‚¬μ©
- **μµμ†ν•μ μ½”λ“ λ³€κ²½**: κΈ°μ΅΄ μ½”λ“ μμ • μµμ†ν™”

## π—οΈ Phaseλ³„ κµ¬ν„ κ³„ν

### **Phase 1: API Client μ—λ¬ μ •λ³΄ κ°•ν™”** β… **μ™„λ£**
#### λ©μ 
API μ—λ¬ μ‘λ‹µμ— errorCodeλ¥Ό ν¬ν•¨ν•μ—¬ μƒμ„Έν• μ—λ¬ μ •λ³΄ μ „λ‹¬

#### μ™„λ£λ μ‘μ—…
1. **packages/api-client/src/types.ts**
   - ApiError ν΄λμ¤μ— `errorCode?: string` ν•„λ“ μ¶”κ°€
   - ErrorResponse νƒ€μ… import λ° re-export

2. **packages/api-client/src/api-client.ts**
   - μ—λ¬ μ‘λ‹µ νμ‹± λ΅μ§ κ°μ„ 
   - `{ error: ErrorResponse }` κµ¬μ΅°μ—μ„ errorCode μ¶”μ¶
   - timeout λ° λ„¤νΈμ›ν¬ μ—λ¬μ—μ„λ„ errorCode optional μ²λ¦¬

3. **packages/api-client/package.json**
   - `@imkdw-dev/types` μμ΅΄μ„± μ¶”κ°€

#### κ²°κ³Ό
- ApiError μΈμ¤ν„΄μ¤κ°€ μ„λ²„μ μƒμ„Έ μ—λ¬ μ½”λ“λ¥Ό ν¬ν•¨ν•κ² λ¨
- λΉλ“ κ²€μ¦ μ™„λ£

---

### **Phase 2: μ„λ²„ μ•΅μ… λνΌ κµ¬ν„** π”„ **λ‹¤μ μ‘μ—…**
#### λ©μ 
ν™κ²½μ„ μλ™ κ°μ§€ν•μ—¬ μ μ ν• μ—λ¬ μ²λ¦¬λ¥Ό μν–‰ν•λ” μ¤‘μ•™ λνΌ ν•¨μ μƒμ„±

#### κ³„νλ μ‘μ—…
1. **packages/actions/src/lib/action-wrapper.ts** (μ‹ κ·)
   ```typescript
   - μ„λ²„/ν΄λΌμ΄μ–ΈνΈ ν™κ²½ κ°μ§€ λ΅μ§
   - μ„λ²„: notFound(), forbidden(), unauthorized() νΈμ¶
   - ν΄λΌμ΄μ–ΈνΈ: toast μλ™ ν‘μ‹
   - μ—λ¬ μ½”λ“λ³„ ν•κΈ€ λ©”μ‹μ§€ λ§¤ν•‘
   ```

2. **μ—λ¬ λ©”μ‹μ§€ λ§¤ν•‘ μ •μ**
   - κ° ExceptionCodeμ— λ€ν• μ‚¬μ©μ μΉν™”μ  λ©”μ‹μ§€

#### ν•µμ‹¬ κµ¬ν„ ν¬μΈνΈ
- `typeof window === 'undefined'`λ΅ μ„λ²„/ν΄λΌμ΄μ–ΈνΈ ν™κ²½ κ°μ§€
- μƒνƒ μ½”λ“λ³„ μ μ ν• μ²λ¦¬:
  - 404 β†’ `notFound()`
  - 403 β†’ `forbidden()`
  - 401 β†’ `unauthorized()`
  - κΈ°νƒ€ β†’ toast ν‘μ‹

---

### **Phase 3: κΈ°μ΅΄ μ•΅μ… ν•¨μ λν•‘** π“‹ **λ€κΈ°**
#### λ©μ 
λ¨λ“  μ„λ²„ μ•΅μ…μ— μ—λ¬ μ²λ¦¬ λνΌ μ μ©

#### κ³„νλ μ‘μ—…
1. **packages/actions/src/member.action.ts**
   - `getCurrentMember`, `getMember` ν•¨μ λν•‘

2. **packages/actions/src/auth.action.ts**
   - `getOAuthUrl` ν•¨μ λν•‘

#### λν•‘ ν¨ν„΄
```typescript
export const getMember = withErrorHandling(async (id) => {
  return apiClient.get(...);
});
```

---

### **Phase 4: ν†µν•© ν…μ¤νΈ λ° κ²€μ¦** π“‹ **λ€κΈ°**
#### λ©μ 
μ „μ²΄ μ‹μ¤ν…μ΄ μλ„λ€λ΅ λ™μ‘ν•λ”μ§€ κ²€μ¦

#### ν…μ¤νΈ μ‹λ‚λ¦¬μ¤
1. **ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈ ν…μ¤νΈ**
   - μ—λ¬ λ°μƒ μ‹ toast ν‘μ‹ ν™•μΈ
   - λ‹¤μ–‘ν• μ—λ¬ μ½”λ“ ν…μ¤νΈ

2. **μ„λ²„ μ»΄ν¬λ„νΈ ν…μ¤νΈ**
   - 404 μ—λ¬ β†’ notFound() νμ΄μ§€
   - 403 μ—λ¬ β†’ forbidden() νμ΄μ§€
   - 401 μ—λ¬ β†’ unauthorized() νμ΄μ§€

3. **Playwright E2E ν…μ¤νΈ**
   - μ‹¤μ  μ‚¬μ©μ μ‹λ‚λ¦¬μ¤ κ²€μ¦

## π“ ν”„λ΅μ νΈ κµ¬μ΅° λ¶„μ„

### ν„μ¬ μ—λ¬ μ²λ¦¬ νλ¦„
```
API Server (CustomException)
β†’ ErrorResponse { statusCode, errorCode, message, timestamp, path }
β†’ ApiClient (ApiError μƒμ„±)
β†’ Server Actions (packages/actions)
β†’ Client/Server Components
```

### κΈ°μ΅΄ μ»΄ν¬λ„νΈ κµ¬μ΅°
- **ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈ**: `'use client'` μ§€μ‹μ–΄ μ‚¬μ©, toast μ‹μ¤ν… ν™μ© κ°€λ¥
- **μ„λ²„ μ»΄ν¬λ„νΈ**: μ„λ²„μ—μ„ μ‹¤ν–‰, Next.js 15 ν•¨μ μ‚¬μ© κ°€λ¥
- **Toast μ‹μ¤ν…**: packages/uiμ— μ΄λ―Έ κµ¬ν„λ¨ (`useToast`, global `toast` ν•¨μ)

### μ—λ¬ μ‘λ‹µ κµ¬μ΅°
```typescript
interface ErrorResponse {
  statusCode: number;
  errorCode: ExceptionCode;
  message: string;
  timestamp: string;
  path: string;
}
```

## π― κµ¬ν„ λ©ν‘ μ¬ν™•μΈ

### ν•µμ‹¬ μ›μΉ™
1. **ν¬λ…ν• μ—λ¬ μ²λ¦¬**: νΈμ¶μκ°€ ν™κ²½ κµ¬λ¶„ λ¶ν•„μ”
2. **μµμ†ν•μ μ½”λ“ λ³€κ²½**: λνΌλ§ μ¶”κ°€
3. **μΌκ΄€λ UX**: λ¨λ“  μ—λ¬κ°€ λ™μΌν•κ² μ²λ¦¬
4. **Next.js 15 ν™μ©**: κ³µμ‹ ν•¨μ μ‚¬μ©

### μ„±κ³µ κΈ°μ¤€
- ν΄λΌμ΄μ–ΈνΈμ—μ„ μ—λ¬ μ‹ μ μ ν• toast ν‘μ‹
- μ„λ²„μ—μ„ μ—λ¬ μ‹ μ μ ν• νμ΄μ§€λ΅ λ¦¬λ‹¤μ΄λ ‰μ…
- κΈ°μ΅΄ μ½”λ“ λ³€κ²½ μµμ†ν™”
- νƒ€μ… μ•μ „μ„± λ³΄μ¥

## π“… λ‹¤μ μ„Έμ… μ‘μ—… κ³„ν

### μ¦‰μ‹ μ§„ν–‰ν•  μ‘μ—…
1. **Phase 2 μ‹μ‘**: `packages/actions/src/lib/action-wrapper.ts` κµ¬ν„
2. ν™κ²½ κ°μ§€ λ° μ—λ¬ μ²λ¦¬ λ΅μ§ μ‘μ„±
3. μ—λ¬ μ½”λ“λ³„ ν•κΈ€ λ©”μ‹μ§€ λ§¤ν•‘ μ •μ

### μ£Όμμ‚¬ν•­
- `typeof window === 'undefined'`λ΅ μ„λ²„/ν΄λΌμ΄μ–ΈνΈ κµ¬λ¶„
- Next.js 15μ `notFound()`, `forbidden()`, `unauthorized()` ν•¨μ μ‚¬μ©
- κΈ°μ΅΄ toast μ‹μ¤ν… ν™μ© (`@imkdw-dev/ui`μ toast ν•¨μ)
- ν•„μ”ν•μ§€ μ•μ€ μ½”λ“λ” μ λ€ μ‘μ„±ν•μ§€ μ•κΈ°

### ν…μ¤νΈ κ³„ν
- κ° Phase μ™„λ£ ν›„ λ‹¨κ³„λ³„ κ²€μ¦
- μµμΆ… Playwright E2E ν…μ¤νΈλ΅ μ „μ²΄ μ‹λ‚λ¦¬μ¤ ν™•μΈ

---

**μ‘μ„±μΌ**: 2025-01-20
**ν„μ¬ μ§„ν–‰λ¥ **: Phase 1 μ™„λ£ (25%)
**λ‹¤μ μ‘μ—…**: Phase 2 - μ„λ²„ μ•΅μ… λνΌ κµ¬ν„